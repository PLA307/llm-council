## 引用功能问题修复计划

### 问题分析
1. **引用状态清除功能异常**：当用户点击"清除所有"按钮时，`quotedItems`数组被清空，但`Stage3`组件内部的`isQuoted`状态未同步更新，导致UI仍然显示为引用状态。
2. **引用逻辑不明确**：当前系统支持引用任意历史对话中的阶段3内容，但需要明确引用规则。

### 修复方案

#### 1. 修复引用状态清除功能
- **修改Stage3.jsx**：
  - 添加`useEffect`钩子，监听全局引用清除事件
  - 添加`isAllQuotesCleared`属性，接收来自父组件的清除信号
  - 当收到清除信号时，重置组件内部的`isQuoted`状态

- **修改ChatInterface.jsx**：
  - 添加`isAllQuotesCleared`状态，用于标记是否已清除所有引用
  - 在`clearAllQuotes`函数中，设置`isAllQuotesCleared`为`true`，然后在下次渲染后重置为`false`
  - 将`isAllQuotesCleared`属性传递给所有`Stage3`组件实例

#### 2. 明确引用逻辑
- **引用规则**：允许用户引用对话历史中任意阶段3的内容
- **引用数量限制**：最多支持5条引用记录
- **引用显示**：引用内容会显示在输入框上方，包含阶段、答案序号和预览内容
- **引用清除**：支持单条清除和全部清除

### 技术实现细节
1. 使用React的状态管理和生命周期机制实现组件间通信
2. 采用事件驱动的方式处理引用清除操作
3. 确保在不同场景下（单条清除、全部清除、消息发送后）引用状态都能正确同步
4. 保持引用功能的易用性和直观性

### 预期效果
- 用户点击"清除所有"按钮后，所有引用状态立即清除，UI恢复正常
- 引用功能逻辑清晰，用户可以方便地引用历史对话内容
- 系统性能不受影响，引用操作流畅响应

### 修改的文件
- `frontend/src/components/Stage3.jsx`
- `frontend/src/components/ChatInterface.jsx`